<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | Eventify</title>
    <link rel="stylesheet" href="../css/register.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="icon" href="./img/planner1.webp" style="border-radius: 50%" />
    <link rel="icon" href="../img/planner1.webp" style="border-radius: 50%" />
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

     <!-- Vercel Web Analytics -->
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments) };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>

    <style>
      body {
        display: flex;
        margin-top: 33px;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: fit-content;
        background: url(../img/planner7.jpg) no-repeat;
        background-size: cover;
        background-position: center;
        flex-direction: column;
      }

      .active {
        background-color: transparent;
        color: #0b52cd;
      }
    </style>

    <!-- Vercel Web Analytics -->
    <script>
      window.va =
        window.va ||
        function () {
          (window.va.q = window.va.q || []).push(arguments);
        };
    </script>
    <script src="/_vercel/insights/script.js"></script>
  </head>
  <body>
    <section id="header">
      <div class="header-container">
        <h1 style="user-select: none; font-size: 30px; letter-spacing: 1px; font-weight: bold;">
          <img src="../img/event3.jpg" class="home-img" style="margin-right: 5px;"> EVENTIFY
          <i class="fa-solid fa-x" id="close" style="cursor: pointer; visibility: hidden; margin-left: 60px;"></i>
          <i class="fa-solid fa-bars" id="menu" style="cursor: pointer; visibility: visible;"></i>
        </h1>
        <nav class="nav">
          <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../index.html#about-scroll">About</a></li>
            <li><a href="../index.html#service-scroll">Service</a></li>
            <li><a href="../index.html#our-team">Team</a></li>
            <div class="dropdown">
              <li><a href="../index.html#testimony-main">Testimony</a></li>
              <div class="dropdown-content">
                <a href="../index.html#testimony-main">John Paul</a><br>
                <a href="../index.html#testimony-main">Ayan Trasy</a><br>
                <a href="../index.html#testimony-main">Nji Pekins</a>
              </div>
            </div>
            <li class="con"><a href="../index.html#contact-us">Contact</a></li>
            <button class="signIn current" style="width: 30%;"><a href="/html/register.html">Sign Up</a></button>
          </ul>
        </nav>
      </div>
    </section>

    <div class="toggle" style="margin-top: 40px">
      <div class="customer" id="regCus" onclick="showCustomerSec()">
        Login As Customer
      </div>
      <p class="divide"></p>
      <div class="planner" id="regPlan" onclick="showPlannerSec()">
        Login As Planner
      </div>
    </div>

    <section class="wrapper" style="margin-bottom: 30px" id="regCustomer">
      <div class="borderline">
        <form id="customerLoginForm">
          <h1>Sign In As Customer</h1>
          <div class="input_box">
            <box-icon name="rename" color="#4c0e2e"></box-icon>
            <input
              type="text"
              name="full_name"
              id="full_name"
              minlength="2"
              maxlength="30"
              required
            />
            <label for="username">Full Name</label>
            <i></i>
            <small id="titleerror">error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="envelope"></box-icon>
            <input name="email" id="email" type="email" required />
            <label for="email">Email Address</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input name="password" id="password" type="password" required />
            <label for="password">Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="field">
            <input
              type="submit"
              class="btn"
              name="submit"
              value="Login As Customer"
              required
              style="color: white; font-size: 18px"
            />
          </div>

          <p class="kudi">
            Don't Already have an account?
            <a href="../html/register.html">Register</a>
          </p>
        </form>
      </div>
    </section>

    <section
      class="wrapper closePlan"
      style="margin-bottom: 30px"
      id="regPlanner"
    >
      <div class="borderline">
        <form id="plannerLoginForm">
          <h1>Sign In As Planer</h1>
          <div class="input_box">
            <box-icon name="rename" color="#4c0e2e"></box-icon>
            <input
              type="text"
              name="full_name"
              id="planner_full_name"
              minlength="2"
              maxlength="30"
              required
            />
            <label for="username">Full Name</label>
            <i></i>
            <small id="titleerror">error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="envelope" color="#4c0e2e"></box-icon>
            <input name="email" id="planner_email" type="email" required />
            <label for="email">Email Address</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input
              name="password"
              id="planner_password"
              type="password"
              required
            />
            <label for="password">Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="field">
            <input
              type="submit"
              class="btn"
              name="submit"
              value="Login As Planner"
              required
              style="color: white; font-size: 18px"
            />
          </div>

          <p class="kudi">
            Don't Already have an account?
            <a href="../html/register.html">Register</a>
          </p>
        </form>
      </div>
    </section>

    <script>
      // Mobile menu toggle functionality
      document.addEventListener('DOMContentLoaded', function() {
        const menuBtn = document.getElementById('menu');
        const closeBtn = document.getElementById('close');
        const header = document.getElementById('header');

        menuBtn.addEventListener('click', function() {
          header.classList.add('menu-open');
        });

        closeBtn.addEventListener('click', function() {
          header.classList.remove('menu-open');
        });
      });

      function showCustomerSec() {
        document.getElementById("regCus").classList.add("active");
        document.getElementById("regPlan").classList.remove("active");
        document.getElementById("regCustomer").classList.remove("closeCus");
        document.getElementById("regPlanner").classList.add("closePlan");
        document.getElementById("regCus").style.color = "#0b52cd";
        document.getElementById("regCus").style.opacity = "1";
        document.getElementById("regPlan").style.color = "black";
        document.getElementById("regPlan").style.opacity = "0.4";
      }

      function showPlannerSec() {
        document.getElementById("regPlan").classList.add("active");
        document.getElementById("regCus").classList.remove("active");
        document.getElementById("regPlanner").classList.remove("closePlan");
        document.getElementById("regCustomer").classList.add("closeCus");
        document.getElementById("regCus").style.color = "black";
        document.getElementById("regCus").style.opacity = "0.4";
        document.getElementById("regPlan").style.color = "#0b52cd";
        document.getElementById("regPlan").style.opacity = "1";
      }

      // Login functionality
      document.addEventListener("DOMContentLoaded", function () {
        const customerForm = document.getElementById("customerLoginForm");
        const plannerForm = document.getElementById("plannerLoginForm");

        const customerSubmitBtn = customerForm.querySelector(".btn");
        const plannerSubmitBtn = plannerForm.querySelector(".btn");

        async function handleLogin(formData, userType, submitButton) {
          // Change button text and disable it on submission
          const originalText = submitButton.value;
          submitButton.value = "Logging in...";
          submitButton.disabled = true;

          try {
            const response = await fetch("/api/auth/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              credentials: "include",
              body: JSON.stringify({
                email: formData.get("email"),
                password: formData.get("password"),
                full_name: formData.get("full_name"),
              }),
            });

            const data = await response.json();

            if (response.ok && data.user) {
              localStorage.setItem("user", JSON.stringify(data.user));
              console.log("Login successful!");

              // Redirect based on user_type
              if (data.user.user_type === "customer") {
                window.location.href = "/html/customer-dashboard.html";
              } else if (data.user.user_type === "planner") {
                window.location.href = "/html/planner-dashboard.html";
              } else {
                window.location.href = "/";
              }
            } else if (response.ok && !data.user) {
              console.log(
                "Login successful, but user data missing from response."
              );
              alert(data.error || "Login failed");
            } else {
              alert(data.error || "Login failed");
            }
          } catch (error) {
            alert("Login failed. Please try again.");
            console.error("Login error:", error);
          } finally {
            submitButton.value = originalText;
            submitButton.disabled = false;
          }
        }

        customerForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(customerForm);
          await handleLogin(formData, "customer", customerSubmitBtn);
        });

        plannerForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(plannerForm);
          await handleLogin(formData, "planner", plannerSubmitBtn);
        });
      });
    </script>
  </body>



  <!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/689141d1fcd547192ddd8490/1j1rmi73k';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->



</html>