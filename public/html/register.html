<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | Eventify</title>
    <link rel="stylesheet" href="../css/register.css" />

    <link rel="icon" href="./img/planner1.webp" style="border-radius: 50%" />
    <link rel="icon" href="../img/planner1.webp" style="border-radius: 50%" />
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- Vercel Web Analytics -->
    <script>
      window.va =
        window.va ||
        function () {
          (window.va.q = window.va.q || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>

    <!-- Speed Insight Analytics -->
    <script>
      window.si =
        window.si ||
        function () {
          (window.siq = window.siq || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>

    <style>
      body {
        display: flex;
        margin-top: 33px;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: fit-content;
        background: url(../img/planner7.jpg) no-repeat;
        background-size: cover;
        background-position: center;
        flex-direction: column;
      }

      .active {
        background-color: transparent;
        color: #0b52cd;
      }

      /* Header Styles */
      #header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: #37517e;
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
      }

      .header-container h1 {
        display: flex;
        align-items: center;
        margin: 0;
        color: #fff;
      }

      .home-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }

      .nav ul {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        align-items: center;
        gap: 2rem;
      }

      .nav a {
        text-decoration: none;
        color: white;
        font-weight: 500;
        transition: color 0.3s ease;
        font-size: 20px;
      }

      .nav a:hover {
        color: gold;
      }

      .dropdown {
        position: relative;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background: white;
        min-width: 160px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        padding: 0.5rem 0;
        top: 100%;
        left: 0;
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }

      .dropdown-content a {
        display: block;
        padding: 0.5rem 1rem;
        color: #000;
        font-weight: bold;
      }

      .dropdown-content a:hover {
        color: #093ba8;
      }

      .signIn {
        background: #0b52cd;
        color: white !important;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .signIn:hover {
        background: #093ba8;
        transform: translateY(-2px);
      }

      .signIn a {
        color: white !important;
        text-decoration: none;
      }

      .mobile-back-btn {
        display: none;
        background: #0b52cd;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .mobile-back-btn:hover {
        background: #093ba8;
        transform: translateY(-2px);
      }

      #menu,
      #close {
        display: none;
      }

      /* Mobile Styles */
      @media (max-width: 700px) {
        body {
          margin-top: 80px;
        }

        .header-container {
          padding: 1rem;
        }

        .header-container h1 {
          font-size: 24px !important;
        }

        .home-img {
          width: 35px;
          height: 35px;
        }

        .nav {
          display: none;
        }

        .mobile-back-btn {
          display: inline-block;
        }

        #menu,
        #close {
          display: none !important;
          visibility: hidden !important;
        }
      }

      /* Tablet and smaller desktop */
      @media (max-width: 1024px) and (min-width: 701px) {
        .header-container {
          padding: 1rem 1.5rem;
        }

        .nav ul {
          gap: 1.5rem;
        }

        .signIn {
          padding: 0.6rem 1.2rem;
          font-size: 14px;
        }
      }

      @media (min-width: 1100px) {
        .toggle {
          margin-top: 120px !important;
        }
      }
    </style>
  </head>
  <body>
    <section id="header">
      <div class="header-container">
        <h1
          style="
            user-select: none;
            font-size: 30px;
            letter-spacing: 1px;
            font-weight: bold;
          "
        >
          <img
            src="../img/event3.jpg"
            class="home-img"
            style="margin-right: 5px"
          />
          EVENTIFY
        </h1>

        <!-- Desktop Navigation -->
        <nav class="nav">
          <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../index.html#about-scroll">About</a></li>
            <li><a href="../index.html#service-scroll">Service</a></li>
            <li><a href="../index.html#our-team">Team</a></li>
            <div class="dropdown">
              <li><a href="../index.html#testimony-main">Testimony</a></li>
              <div class="dropdown-content">
                <a href="../index.html#testimony-main">John Paul</a><br />
                <a href="../index.html#testimony-main">Alan Tracy</a><br />
                <a href="../index.html#testimony-main">Nji Pekins</a>
              </div>
            </div>
            <li class="con"><a href="../index.html#contact-us">Contact</a></li>
            <button class="signIn current" style="width: 30%">
              <a href="/html/register.html">Sign Up</a>
            </button>
          </ul>
        </nav>

        <!-- Mobile Back to Home Button -->
        <a href="../index.html" class="mobile-back-btn">
          <i class="fas fa-arrow-left" style="margin-right: 8px"></i>
          Back to Home
        </a>
      </div>
    </section>

    <div class="toggle" style="margin-top: 30px">
      <div class="customer" id="regCus" onclick="showCustomerSec()">
        Register As Customer
      </div>
      <p class="divide"></p>
      <div class="planner" id="regPlan" onclick="showPlannerSec()">
        Register As Planner
      </div>
    </div>

    <div class="wrapper" style="margin-bottom: 90px" id="regCustomer">
      <div class="borderline">
        <h1 style="color: #0b52cd !important">Sign Up As Customer</h1>
        <form id="customerRegisterForm">
          <div class="input_box">
            <box-icon name="rename" color="#4c0e2e"></box-icon>
            <input
              type="text"
              id="title"
              minlength="2"
              maxlength="30"
              name="full_name"
              autocomplete="off"
              required
            />
            <label for="title">Full Name</label>
            <i></i>
            <small id="titleerror">error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="envelope"></box-icon>
            <input
              name="email"
              id="email"
              autocomplete="off"
              type="email"
              required
            />
            <label for="email">Email Address</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="phone-call"></box-icon>
            <input
              name="phone_number"
              id="phone_number"
              autocomplete="off"
              type="number"
              required
            />
            <label for="phone_number">Phone Number</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input
              name="password"
              id="password"
              autocomplete="off"
              type="password"
              required
            />
            <label for="password">Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input
              name="confirm_password"
              id="confirm_password"
              autocomplete="off"
              type="password"
              required
            />
            <label for="confirm_password">Confirm Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="terms">
            <input type="checkbox" required />
            <p style="margin-left: 10px">
              Agree to <span>Terms</span> and <span>Condition</span>
            </p>
          </div>

          <div class="field">
            <input
              style="color: white; font-size: 18px"
              type="submit"
              class="btn"
              name="submit"
              value="Register As Customer"
              required
            />
          </div>

          <div class="kudi">
            Already a member? <a href="../html/login.html">Sign In</a>
          </div>
        </form>
      </div>
    </div>

    <div class="wrapper closePlan" style="margin-bottom: 50px" id="regPlanner">
      <div class="borderline">
        <h1 style="color: #0b52cd !important">Sign Up As Planner</h1>
        <form id="plannerRegisterForm">
          <div class="input_box">
            <box-icon name="rename" color="#4c0e2e"></box-icon>
            <input
              type="text"
              id="planner_title"
              minlength="2"
              maxlength="30"
              name="full_name"
              autocomplete="off"
              required
            />
            <label for="title">Full Name</label>
            <i></i>
            <small id="titleerror">error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="envelope"></box-icon>
            <input
              name="admin_email"
              id="admin_email"
              autocomplete="off"
              type="email"
              required
            />
            <label for="admin_email">Email Address</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="phone-call"></box-icon>
            <input
              name="admin_phone_number"
              id="admin_phone_number"
              autocomplete="off"
              type="number"
              required
            />
            <label for="admin_phone_number">Phone Number</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input
              name="admin_password"
              id="admin_password"
              autocomplete="off"
              type="password"
              required
            />
            <label for="admin_password">Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="input_box">
            <box-icon type="solid" name="timer" color="#4c0e2e"></box-icon>
            <input
              name="admin_confirm_password"
              id="admin_confirm_password"
              autocomplete="off"
              type="password"
              required
            />
            <label for="admin_confirm_password">Confirm Password</label>
            <i></i>
            <small>error message</small>
          </div>

          <div class="terms">
            <input type="checkbox" required />
            <p style="margin-left: 10px">
              Agree to <span>Terms</span> and <span>Condition</span>
            </p>
          </div>

          <div class="field">
            <input
              type="submit"
              style="color: white; font-size: 17px"
              class="btn"
              name="submit"
              value="Register As Event Planner"
              required
            />
          </div>

          <div class="kudi">
            Already a member? <a href="../html/login.html">Sign In</a>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Toggle
      function showCustomerSec() {
        const regCus = document.getElementById("regCus");
        const regPlan = document.getElementById("regPlan");
        const regCustomer = document.getElementById("regCustomer");
        const regPlanner = document.getElementById("regPlanner");

        regCus.classList.add("active");
        regPlan.classList.remove("active");

        regCustomer.classList.remove("closeCus");
        regPlanner.classList.add("closePlan");

        regCus.style.color = "#0b52cd";
        regCus.style.opacity = "1";
        regPlan.style.color = "black";
        regPlan.style.opacity = "0.4";
      }

      function showPlannerSec() {
        const regCus = document.getElementById("regCus");
        const regPlan = document.getElementById("regPlan");
        const regCustomer = document.getElementById("regCustomer");
        const regPlanner = document.getElementById("regPlanner");

        regPlan.classList.add("active");
        regCus.classList.remove("active");

        regPlanner.classList.remove("closePlan");
        regCustomer.classList.add("closeCus");

        regCus.style.color = "black";
        regCus.style.opacity = "0.4";
        regPlan.style.color = "#0b52cd";
        regPlan.style.opacity = "1";
      }

      // Registration functionality
      document.addEventListener("DOMContentLoaded", function () {
        const customerForm = document.getElementById("customerRegisterForm");
        const plannerForm = document.getElementById("plannerRegisterForm");

        // Get the submit buttons
        const customerSubmitBtn = customerForm.querySelector(".btn");
        const plannerSubmitBtn = plannerForm.querySelector(".btn");

        async function handleRegistration(formData, userType, submitButton) {
          const password =
            formData.get("password") || formData.get("admin_password");
          const confirmPassword =
            formData.get("confirm_password") ||
            formData.get("admin_confirm_password");

          if (password !== confirmPassword) {
            alert("Passwords do not match");
            return;
          }

          // Change button text and disable it on submission
          const originalText = submitButton.value;
          submitButton.value = "Registering...";
          submitButton.disabled = true;

          try {
            const response = await fetch("/api/auth/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              credentials: "include",
              body: JSON.stringify({
                full_name: formData.get("full_name"),
                email: formData.get("email") || formData.get("admin_email"),
                phone_number:
                  formData.get("phone_number") ||
                  formData.get("admin_phone_number"),
                password: password,
                user_type: userType,
              }),
            });

            const data = await response.json();

            if (response.ok) {
              localStorage.setItem("user", JSON.stringify(data.user));
              alert("Registration successful!");

              if (typeof window.va === "function") {
                window.va("track", "registration_success", {
                  user_type: userType,
                  email_domain: (
                    formData.get("email") || formData.get("admin_email")
                  ).split("@")[1],
                });
              }

              if (data.user.user_type === "customer") {
                window.location.href = "/html/customer-dashboard.html";
              } else if (data.user.user_type === "planner") {
                window.location.href = "/html/planner-dashboard.html";
              } else {
                window.location.href = "/";
              }
            } else {
              alert(data.error || "Registration failed");
            }
          } catch (error) {
            alert("Registration failed. Please try again.");
            console.error("Registration error:", error);
          } finally {
            submitButton.value = originalText;
            submitButton.disabled = false;
          }
        }

        customerForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(customerForm);
          await handleRegistration(formData, "customer", customerSubmitBtn);
        });

        plannerForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(plannerForm);
          await handleRegistration(formData, "planner", plannerSubmitBtn);
        });
      });
    </script>
  </body>

  <!--Start of Tawk.to Script-->
  <script type="text/javascript">
    var Tawk_API = Tawk_API || {},
      Tawk_LoadStart = new Date();
    (function () {
      var s1 = document.createElement("script"),
        s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = "https://embed.tawk.to/689141d1fcd547192ddd8490/1j1rmi73k";
      s1.charset = "UTF-8";
      s1.setAttribute("crossorigin", "*");
      s0.parentNode.insertBefore(s1, s0);
    })();
  </script>
  <!--End of Tawk.to Script-->
</html>
